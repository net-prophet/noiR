(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{1088:function(module,exports,__webpack_require__){"use strict";__webpack_require__(4),__webpack_require__(49),__webpack_require__(44),__webpack_require__(35),__webpack_require__(41),__webpack_require__(1089),__webpack_require__(1090),__webpack_require__(7),__webpack_require__(45);var _clientApi=__webpack_require__(59),_clientLogger=__webpack_require__(37),_configFilename=__webpack_require__(1091);function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}(_configFilename.args||_configFilename.argTypes)&&_clientLogger.logger.warn("Invalid args/argTypes in config, ignoring.",JSON.stringify({args:_configFilename.args,argTypes:_configFilename.argTypes})),_configFilename.decorators&&_configFilename.decorators.forEach((function(decorator){return(0,_clientApi.addDecorator)(decorator,!1)})),_configFilename.loaders&&_configFilename.loaders.forEach((function(loader){return(0,_clientApi.addLoader)(loader,!1)})),(_configFilename.parameters||_configFilename.globals||_configFilename.globalTypes)&&(0,_clientApi.addParameters)(_objectSpread(_objectSpread({},_configFilename.parameters),{},{globals:_configFilename.globals,globalTypes:_configFilename.globalTypes}),!1),_configFilename.argTypesEnhancers&&_configFilename.argTypesEnhancers.forEach((function(enhancer){return(0,_clientApi.addArgTypesEnhancer)(enhancer)}))},1091:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"parameters",(function(){return parameters}));var parameters={actions:{argTypesRegex:"^on[A-Z].*"}}},1092:function(module,exports,__webpack_require__){"use strict";(function(module){(0,__webpack_require__(379).configure)([__webpack_require__(1093),__webpack_require__(1094)],module,!1)}).call(this,__webpack_require__(115)(module))},1093:function(module,exports){function webpackEmptyContext(req){var e=new Error("Cannot find module '"+req+"'");throw e.code="MODULE_NOT_FOUND",e}webpackEmptyContext.keys=function(){return[]},webpackEmptyContext.resolve=webpackEmptyContext,module.exports=webpackEmptyContext,webpackEmptyContext.id=1093},1094:function(module,exports,__webpack_require__){var map={"./stories/BroadcastPreview.stories.js":1095,"./stories/SimplePeer.stories.js":1111};function webpackContext(req){var id=webpackContextResolve(req);return __webpack_require__(id)}function webpackContextResolve(req){if(!__webpack_require__.o(map,req)){var e=new Error("Cannot find module '"+req+"'");throw e.code="MODULE_NOT_FOUND",e}return map[req]}webpackContext.keys=function webpackContextKeys(){return Object.keys(map)},webpackContext.resolve=webpackContextResolve,module.exports=webpackContext,webpackContext.id=1094},1095:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"Preview",(function(){return Preview}));__webpack_require__(186),__webpack_require__(5);var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(17),_components__WEBPACK_IMPORTED_MODULE_4__=(__webpack_require__(0),__webpack_require__(127)),_components_IonUserMediaProvider__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(140);__webpack_exports__.default={title:"BroadcastPreview",component:_components__WEBPACK_IMPORTED_MODULE_4__.a};var Template=function Template(args){return Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(_components_IonUserMediaProvider__WEBPACK_IMPORTED_MODULE_5__.a,{children:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(_components__WEBPACK_IMPORTED_MODULE_4__.a,Object.assign({width:400},args))})};Template.displayName="Template";var Preview=Template.bind({});Preview.args={},Preview.parameters=Object.assign({storySource:{source:"(args) => <IonUserMediaProvider><BroadcastPreview width={400} {...args} /></IonUserMediaProvider>"}},Preview.parameters)},1111:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"OnePeer",(function(){return OnePeer})),__webpack_require__.d(__webpack_exports__,"BuddyTest",(function(){return BuddyTest}));__webpack_require__(4),__webpack_require__(9),__webpack_require__(20),__webpack_require__(1100),__webpack_require__(25),__webpack_require__(22),__webpack_require__(16),__webpack_require__(14),__webpack_require__(24),__webpack_require__(12),__webpack_require__(21),__webpack_require__(186),__webpack_require__(6),__webpack_require__(5),__webpack_require__(7),__webpack_require__(11),__webpack_require__(19),__webpack_require__(15),__webpack_require__(18);var jsx_runtime=__webpack_require__(17),react=__webpack_require__(0),react_default=__webpack_require__.n(react),createMuiTheme=(__webpack_require__(49),__webpack_require__(1102),__webpack_require__(207),__webpack_require__(498)),ThemeProvider=__webpack_require__(1139),components=__webpack_require__(127),IonUserMediaProvider=__webpack_require__(140);function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(arr)))return;var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var theme=Object(createMuiTheme.a)({});function StoryProvider(_ref){var children=_ref.children,debug=_ref.debug,canvas=react_default.a.createRef(),_React$useState2=_slicedToArray(react_default.a.useState(),2),stream=_React$useState2[0],setStream=_React$useState2[1],rectState=[0,0,10],rectStateVector=[1,1,1],colorSeed=3600*Math.random()*1e3,onFrame=function onFrame(){if(canvas.current){var ctx=canvas.current.getContext("2d"),date=new Date,hue=Math.floor((colorSeed+date.getTime())%36e5/36e5*360),sat=Math.floor((colorSeed+date.getTime())%5e3/5e3*100),lum=Math.floor((colorSeed+date.getTime())%2e4/2e4*100),angle=date.getTime()%6e4/6e4*360*Math.PI/180;ctx.resetTransform(),ctx.filter="blur(1px)",ctx.drawImage(canvas.current,.5,0,canvas.current.width-1,canvas.current.height-.5),ctx.filter="none",ctx.globalAlpha=1,ctx.fillText(date.toISOString()+"  Frame: "+(0).toLocaleString(),canvas.current.width/2,canvas.height/2),ctx.strokeStyle="#000",ctx.strokeText(date.toISOString()+"  Frame: "+(0).toLocaleString(),canvas.current.width/2,canvas.height/2),ctx.translate(rectState[0],rectState[1]),ctx.rotate(angle),ctx.strokeStyle="hsl("+hue+", "+sat+"%, "+lum+"%)",ctx.strokeRect(-rectState[2]/2,-rectState[2]/2,rectState[2],rectState[2]),rectState[0]>=canvas.current.width&&(rectStateVector[0]=-1),rectState[0]<=0&&(rectStateVector[0]=1),rectState[1]>=canvas.current.height&&(rectStateVector[1]=-1),rectState[1]<=0&&(rectStateVector[1]=1),rectState[2]>=200&&(rectStateVector[2]=-1),rectState[2]<=5&&(rectStateVector[2]=1);for(var i=0;i<rectState.length;i++)rectState[i]+=1*rectStateVector[i]}};return react_default.a.useEffect((function(){return setInterval(onFrame,30),!stream&&canvas.current&&setStream(canvas.current.captureStream(30)),function(){}})),Object(jsx_runtime.jsx)("div",{children:Object(jsx_runtime.jsx)(IonUserMediaProvider.a,{children:Object(jsx_runtime.jsx)(components.b,{debug:debug,children:Object(jsx_runtime.jsx)(ThemeProvider.a,{theme:theme,children:children})})})})}StoryProvider.displayName="StoryProvider",StoryProvider.__docgenInfo={description:"",methods:[],displayName:"StoryProvider"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/stories/StoryProvider.js"]={name:"StoryProvider",docgenInfo:StoryProvider.__docgenInfo,path:"src/stories/StoryProvider.js"});__webpack_require__(23),__webpack_require__(50),__webpack_require__(41),__webpack_require__(96),__webpack_require__(112);var Card=__webpack_require__(1143),contexts=__webpack_require__(85),CardHeader=__webpack_require__(1142),VideoView=__webpack_require__(139),Button=__webpack_require__(1141);function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function SimplePeer_slicedToArray(arr,i){return function SimplePeer_arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function SimplePeer_iterableToArrayLimit(arr,i){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(arr)))return;var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function SimplePeer_unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return SimplePeer_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return SimplePeer_arrayLikeToArray(o,minLen)}(arr,i)||function SimplePeer_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function SimplePeer_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function SimplePeer(_ref){var debug=_ref.debug,room=(_ref.publish,_ref.room),address=_ref.address,signal=_ref.signal,subscribe=_ref.subscribe,peerStreams=_ref.peerStreams,setPeerStreams=_ref.setPeerStreams,ion=Object(contexts.c)(),_React$useState2=SimplePeer_slicedToArray(react_default.a.useState(),2),setPublishStream=(_React$useState2[0],_React$useState2[1]),_React$useState4=SimplePeer_slicedToArray(react_default.a.useState(""),2),peerState=_React$useState4[0],setPeerState=_React$useState4[1],_React$useState6=SimplePeer_slicedToArray(react_default.a.useState("SimplePeer ".concat(Math.ceil(100*Math.random()))),2),name=_React$useState6[0],_React$useState8=(_React$useState6[1],SimplePeer_slicedToArray(react_default.a.useState({}),2)),setTracks=(_React$useState8[0],_React$useState8[1]),_React$useState10=SimplePeer_slicedToArray(react_default.a.useState({}),2),setTrackStreams=(_React$useState10[0],_React$useState10[1]),_React$useState12=SimplePeer_slicedToArray(react_default.a.useState({}),2),remoteStreams=_React$useState12[0],setRemoteStreams=_React$useState12[1];function _doPublish(){return(_doPublish=_asyncToGenerator(regeneratorRuntime.mark((function _callee(){var stream;return regeneratorRuntime.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return setPeerState("offering"),_context.next=3,ion.publishUserMedia();case 3:stream=_context.sent,setPublishStream(stream),setPeerStreams((function(ps){return Object.assign({},ps,_defineProperty({},stream.id,name))})),setPeerState("webcam published!");case 7:case"end":return _context.stop()}}),_callee)})))).apply(this,arguments)}react_default.a.useEffect((function SetupPeer(){if(ion&&!ion.client){console.log("SetupPeer");ion.join({room:room,address:address,signal:signal,onTrack:function onTrack(track,stream){console.log("Got track",track,stream,track.id),setTracks((function(previous){return Object.assign({},previous,_defineProperty({},track.id,track))})),setTrackStreams((function(previous){return Object.assign({},previous,_defineProperty({},track.id,stream))})),setRemoteStreams((function(previous){return Object.assign({},previous,_defineProperty({},stream.id,stream))}))}})}}),[ion]);var streamIds=Object.keys(remoteStreams);return Object(jsx_runtime.jsxs)(Card.a,{children:[Object(jsx_runtime.jsx)("div",{style:{display:"inline-block",float:"right",width:"160px",height:"90px"},children:Object(jsx_runtime.jsx)(components.a,{height:"90px",width:"160px"})}),Object(jsx_runtime.jsx)(CardHeader.a,{title:name,subheader:debug?"".concat(peerState," (").concat(ion.ready?"ready":ion.publisherSignalingState,")"):null}),Object(jsx_runtime.jsx)(Button.a,{onClick:function doPublish(){return _doPublish.apply(this,arguments)},children:"Publish Webcam"}),streamIds.length||"No"," remote streams",streamIds.length?Object(jsx_runtime.jsx)("hr",{}):null,streamIds.map((function(id){var stream=remoteStreams[id],name=peerStreams[id];return stream&&subscribe&&name?Object(jsx_runtime.jsx)(SimplePeer_ShowTrack,{stream:stream,name:name,debug:debug},id):null}))]})}SimplePeer.displayName="SimplePeer";var SimplePeer_ShowTrack=function ShowTrack(_ref2){var stream=_ref2.stream,name=_ref2.name,debug=_ref2.debug;return Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsxs)("h6",{children:[name," ",debug?"- Stream ".concat(stream.id):null]}),Object(jsx_runtime.jsx)(VideoView.a,{stream:stream,width:300})]})};SimplePeer.defaultProps={publish:!0,subscribe:!0},SimplePeer.__docgenInfo={description:"",methods:[],displayName:"SimplePeer",props:{publish:{defaultValue:{value:"true",computed:!1},required:!1},subscribe:{defaultValue:{value:"true",computed:!1},required:!1}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/stories/SimplePeer.js"]={name:"SimplePeer",docgenInfo:SimplePeer.__docgenInfo,path:"src/stories/SimplePeer.js"});var Grid=__webpack_require__(1140);function SimplePeer_stories_slicedToArray(arr,i){return function SimplePeer_stories_arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function SimplePeer_stories_iterableToArrayLimit(arr,i){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(arr)))return;var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function SimplePeer_stories_unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return SimplePeer_stories_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return SimplePeer_stories_arrayLikeToArray(o,minLen)}(arr,i)||function SimplePeer_stories_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function SimplePeer_stories_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _objectWithoutProperties(source,excluded){if(null==source)return{};var key,i,target=function _objectWithoutPropertiesLoose(source,excluded){if(null==source)return{};var key,i,target={},sourceKeys=Object.keys(source);for(i=0;i<sourceKeys.length;i++)key=sourceKeys[i],excluded.indexOf(key)>=0||(target[key]=source[key]);return target}(source,excluded);if(Object.getOwnPropertySymbols){var sourceSymbolKeys=Object.getOwnPropertySymbols(source);for(i=0;i<sourceSymbolKeys.length;i++)key=sourceSymbolKeys[i],excluded.indexOf(key)>=0||Object.prototype.propertyIsEnumerable.call(source,key)&&(target[key]=source[key])}return target}__webpack_exports__.default={title:"Simple Peer",component:SimplePeer};var SimplePeer_stories_PeerTemplate=function PeerTemplate(_ref){var count=_ref.count,args=_objectWithoutProperties(_ref,["count"]),_React$useState2=SimplePeer_stories_slicedToArray(react_default.a.useState("room-".concat(Math.ceil(100*Math.random()))),2),room=_React$useState2[0],_React$useState4=(_React$useState2[1],SimplePeer_stories_slicedToArray(react_default.a.useState({}),2)),peerStreams=_React$useState4[0],setPeerStreams=_React$useState4[1],num=null===count?1:count;return Object(jsx_runtime.jsxs)(Grid.a,{container:!0,spacing:4,children:[Object(jsx_runtime.jsx)(Grid.a,{item:!0,xs:12,children:Object(jsx_runtime.jsxs)("h4",{children:["Room: ",room]})}),Array(num).fill(num).map((function(n,idx){return Object(jsx_runtime.jsx)(Grid.a,{item:!0,sm:6,md:4,lg:3,children:Object(jsx_runtime.jsx)(StoryProvider,{children:Object(jsx_runtime.jsx)(SimplePeer,Object.assign({},args,{room:room,peerStreams:peerStreams,setPeerStreams:setPeerStreams}))})},idx)}))]})};SimplePeer_stories_PeerTemplate.displayName="PeerTemplate";var OnePeer=SimplePeer_stories_PeerTemplate.bind({});OnePeer.args={debug:!0};var BuddyTest=SimplePeer_stories_PeerTemplate.bind({});BuddyTest.args={debug:!0,count:4},OnePeer.parameters=Object.assign({storySource:{source:"({ count, ...args }) => {\n  const [room, setRoom] = React.useState(\n    `room-${Math.ceil(Math.random() * 100)}`\n  );\n  const [peerStreams, setPeerStreams] = React.useState({})\n  const num = count === null ? 1 : count\n  return (\n    <Grid container spacing={4}>\n      <Grid item xs={12}>\n        <h4>Room: {room}</h4>\n      </Grid>\n      {Array(num).fill(num).map((n, idx) => (\n        <Grid item sm={6} md={4} lg={3} key={idx}>\n        <StoryProvider>\n          <SimplePeer {...args} room={room} peerStreams={peerStreams} setPeerStreams={setPeerStreams} />\n        </StoryProvider>\n        </Grid>\n      ))}\n    </Grid>\n  );\n}"}},OnePeer.parameters),BuddyTest.parameters=Object.assign({storySource:{source:"({ count, ...args }) => {\n  const [room, setRoom] = React.useState(\n    `room-${Math.ceil(Math.random() * 100)}`\n  );\n  const [peerStreams, setPeerStreams] = React.useState({})\n  const num = count === null ? 1 : count\n  return (\n    <Grid container spacing={4}>\n      <Grid item xs={12}>\n        <h4>Room: {room}</h4>\n      </Grid>\n      {Array(num).fill(num).map((n, idx) => (\n        <Grid item sm={6} md={4} lg={3} key={idx}>\n        <StoryProvider>\n          <SimplePeer {...args} room={room} peerStreams={peerStreams} setPeerStreams={setPeerStreams} />\n        </StoryProvider>\n        </Grid>\n      ))}\n    </Grid>\n  );\n}"}},BuddyTest.parameters)},127:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"b",(function(){return components_IonProvider})),__webpack_require__.d(__webpack_exports__,"a",(function(){return components_BroadcastPreview}));__webpack_require__(4),__webpack_require__(9),__webpack_require__(20),__webpack_require__(23),__webpack_require__(25),__webpack_require__(16),__webpack_require__(14),__webpack_require__(12),__webpack_require__(21),__webpack_require__(6),__webpack_require__(5),__webpack_require__(11),__webpack_require__(96),__webpack_require__(19),__webpack_require__(15),__webpack_require__(18),__webpack_require__(112);var jsx_runtime=__webpack_require__(17),react=__webpack_require__(0),react_default=__webpack_require__.n(react),lib=__webpack_require__(142),contexts=__webpack_require__(85);function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(arr)))return;var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function IonConnectionStatus(){var _useIon=Object(contexts.c)(),connectionState=_useIon.connectionState,signalingState=_useIon.signalingState,address=_useIon.address;return Object(jsx_runtime.jsxs)("div",{children:[address||"Ion"," Status:"," ",connectionState&&signalingState?"".concat(connectionState,", ").concat(signalingState):"unknown!"]})}function IonProvider(_ref){var _ion$client,_ion$client2,_pub$pc,_sub$pc,_pub$pc2,_sub$pc2,children=_ref.children,debug=_ref.debug,_React$useState2=_slicedToArray(react_default.a.useState({client:null,room:null,address:null,signal:null}),2),ion=_React$useState2[0],setIon=_React$useState2[1],_useUserMedia=Object(contexts.d)(),localStream=(_useUserMedia.constraints,_useUserMedia.setConstraints,_useUserMedia.localStream),pub=null===(_ion$client=ion.client)||void 0===_ion$client?void 0:_ion$client.transports[0],sub=null===(_ion$client2=ion.client)||void 0===_ion$client2?void 0:_ion$client2.transports[1],publisherConnectionState=null==pub||null===(_pub$pc=pub.pc)||void 0===_pub$pc?void 0:_pub$pc.connectionState,subscriberConnectionState=null==sub||null===(_sub$pc=sub.pc)||void 0===_sub$pc?void 0:_sub$pc.connectionState,publisherSignalingState=null==pub||null===(_pub$pc2=pub.pc)||void 0===_pub$pc2?void 0:_pub$pc2.signalingState,subscriberSignalingState=null==sub||null===(_sub$pc2=sub.pc)||void 0===_sub$pc2?void 0:_sub$pc2.signalingState;function _publishUserMedia(){return(_publishUserMedia=_asyncToGenerator(regeneratorRuntime.mark((function _callee(){return regeneratorRuntime.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return ion.client.publish(localStream),_context.abrupt("return",localStream);case 2:case"end":return _context.stop()}}),_callee)})))).apply(this,arguments)}function leave(){ion.client&&ion.client.close()}return react_default.a.useEffect((function(){setIon((function(_old){var newState=Object.assign({},_old,{publisherConnectionState:publisherConnectionState,publisherSignalingState:publisherSignalingState,subscriberConnectionState:subscriberConnectionState,subscriberSignalingState:subscriberSignalingState});return newState.publisherConnectionReady="new"===publisherConnectionState||"connected"===publisherConnectionState,newState.publisherSignalingReady="stable"===publisherSignalingState,newState.publisherReady=newState.publisherConnectionReady&&newState.publisherSignalingReady,newState.subscriberConnectionReady="new"===subscriberConnectionState||"connected"===subscriberConnectionState,newState.subscriberSignalingReady="stable"===subscriberSignalingState,newState.subscriberReady=newState.subscriberConnectionReady&&newState.subscriberSignalingReady,newState.connectionReady=newState.publisherConnectionReady&&newState.subscriberConnectionReady,newState.signalingReady=newState.publisherSignalingReady&&newState.subscriberSignalingReady,newState.ready=newState.publisherReady&&newState.subscriberReady,newState}))}),[publisherConnectionState,subscriberConnectionState,publisherSignalingState,subscriberSignalingState]),react_default.a.useEffect((function(){return leave}),[]),Object(jsx_runtime.jsxs)(contexts.a.Provider,{value:Object.assign({},ion,{join:function join(_ref2){var signal=_ref2.signal,room=_ref2.room,address=_ref2.address,onTrack=_ref2.onTrack;if(room){ion.client&&ion.client.close();var joinRoom=room||ion.room,client=new lib.Client(joinRoom,signal||new lib.IonSFUJSONRPCSignal(address||"ws://localhost:7000/ws"));client.ontrack=onTrack,setIon({room:joinRoom,address:address,client:client,signal:signal})}},leave:leave,publishUserMedia:function publishUserMedia(){return _publishUserMedia.apply(this,arguments)}}),children:[children,!0===debug?Object(jsx_runtime.jsx)(IonConnectionStatus,{}):debug]})}IonConnectionStatus.displayName="IonConnectionStatus",IonProvider.displayName="IonProvider",IonConnectionStatus.__docgenInfo={description:"",methods:[],displayName:"IonConnectionStatus"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/IonProvider/IonProvider.js"]={name:"IonConnectionStatus",docgenInfo:IonConnectionStatus.__docgenInfo,path:"src/components/IonProvider/IonProvider.js"}),IonProvider.__docgenInfo={description:"",methods:[],displayName:"IonProvider"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/IonProvider/IonProvider.js"]={name:"IonProvider",docgenInfo:IonProvider.__docgenInfo,path:"src/components/IonProvider/IonProvider.js"});var components_IonProvider=IonProvider;__webpack_require__(140);function BroadcastControls(){return Object(jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Controls"})}BroadcastControls.__docgenInfo={description:"",methods:[],displayName:"BroadcastControls"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/BroadcastControls/BroadcastControls.js"]={name:"BroadcastControls",docgenInfo:BroadcastControls.__docgenInfo,path:"src/components/BroadcastControls/BroadcastControls.js"});var VideoView=__webpack_require__(139);function BroadcastPreview(props){var _useUserMedia=Object(contexts.d)(),localStream=_useUserMedia.localStream,getUserMedia=_useUserMedia.getUserMedia,constraints=_useUserMedia.constraints;return react_default.a.useEffect((function(){localStream||getUserMedia()}),[localStream,constraints]),localStream?Object(jsx_runtime.jsx)(VideoView.a,Object.assign({stream:localStream},props)):Object(jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Requesting video..."})}BroadcastPreview.__docgenInfo={description:"",methods:[],displayName:"BroadcastPreview"};var components_BroadcastPreview=BroadcastPreview;"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/BroadcastPreview/index.js"]={name:"BroadcastPreview",docgenInfo:BroadcastPreview.__docgenInfo,path:"src/components/BroadcastPreview/index.js"})},139:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return VideoView}));__webpack_require__(4),__webpack_require__(22),__webpack_require__(5),__webpack_require__(7),__webpack_require__(207);var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(17),react__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(0),react__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_6__);function _objectWithoutProperties(source,excluded){if(null==source)return{};var key,i,target=function _objectWithoutPropertiesLoose(source,excluded){if(null==source)return{};var key,i,target={},sourceKeys=Object.keys(source);for(i=0;i<sourceKeys.length;i++)key=sourceKeys[i],excluded.indexOf(key)>=0||(target[key]=source[key]);return target}(source,excluded);if(Object.getOwnPropertySymbols){var sourceSymbolKeys=Object.getOwnPropertySymbols(source);for(i=0;i<sourceSymbolKeys.length;i++)key=sourceSymbolKeys[i],excluded.indexOf(key)>=0||Object.prototype.propertyIsEnumerable.call(source,key)&&(target[key]=source[key])}return target}function VideoView(_ref){var stream=_ref.stream,props=_objectWithoutProperties(_ref,["stream"]),videoRef=react__WEBPACK_IMPORTED_MODULE_6___default.a.useRef();return react__WEBPACK_IMPORTED_MODULE_6___default.a.useEffect((function(){stream&&videoRef.current&&setTimeout((function(){videoRef.current.srcObject=stream}),500)}),[stream]),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("video",Object.assign({ref:videoRef,onCanPlay:function onCanPlay(){videoRef.current.play()},autoPlay:!0,playsInline:!0},props))}VideoView.displayName="VideoView",VideoView.__docgenInfo={description:"",methods:[],displayName:"VideoView"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/VideoView/index.js"]={name:"VideoView",docgenInfo:VideoView.__docgenInfo,path:"src/components/VideoView/index.js"})},140:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__(4),__webpack_require__(9),__webpack_require__(20),__webpack_require__(25),__webpack_require__(16),__webpack_require__(14),__webpack_require__(12),__webpack_require__(21),__webpack_require__(6),__webpack_require__(11),__webpack_require__(96),__webpack_require__(19),__webpack_require__(15),__webpack_require__(18),__webpack_require__(112);var jsx_runtime=__webpack_require__(17),react=__webpack_require__(0),react_default=__webpack_require__.n(react),contexts=__webpack_require__(85),lib=__webpack_require__(142);function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(arr)))return;var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function IonUserMediaProvider(_ref){var children=_ref.children,stream=_ref.stream,audio=_ref.audio,video=_ref.video,resolution=_ref.resolution,codec=_ref.codec,simulcast=_ref.simulcast,_React$useState2=_slicedToArray(react_default.a.useState({audio:void 0===audio||audio,video:void 0===video||video,resolution:void 0===resolution?"hd":resolution,codec:void 0===codec?"vp8":codec,simulcast:void 0!==simulcast&&simulcast}),2),constraints=_React$useState2[0],setConstraints=_React$useState2[1],_React$useState4=_slicedToArray(react_default.a.useState(stream),2),localStream=_React$useState4[0],setLocalStream=_React$useState4[1];function _getUserMedia(){return(_getUserMedia=_asyncToGenerator(regeneratorRuntime.mark((function _callee(){var attached;return regeneratorRuntime.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(!stream){_context.next=2;break}return _context.abrupt("return",Object(lib.LocalStream)(stream,constraints));case 2:return _context.next=4,lib.LocalStream.getUserMedia(constraints);case 4:return attached=_context.sent,console.log("Attached",constraints),setLocalStream(attached),_context.abrupt("return",attached);case 8:case"end":return _context.stop()}}),_callee)})))).apply(this,arguments)}var userMedia={constraints:constraints,setConstraints:setConstraints,getUserMedia:function getUserMedia(){return _getUserMedia.apply(this,arguments)},localStream:localStream};return Object(jsx_runtime.jsx)(contexts.b.Provider,{value:userMedia,children:children})}IonUserMediaProvider.displayName="IonUserMediaProvider",IonUserMediaProvider.__docgenInfo={description:"",methods:[],displayName:"IonUserMediaProvider"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/IonUserMediaProvider/IonUserMediaProvider.js"]={name:"IonUserMediaProvider",docgenInfo:IonUserMediaProvider.__docgenInfo,path:"src/components/IonUserMediaProvider/IonUserMediaProvider.js"});__webpack_exports__.a=IonUserMediaProvider},503:function(module,exports,__webpack_require__){__webpack_require__(504),__webpack_require__(655),__webpack_require__(656),__webpack_require__(811),__webpack_require__(1030),__webpack_require__(1062),__webpack_require__(1067),__webpack_require__(1079),__webpack_require__(1081),__webpack_require__(1086),__webpack_require__(1088),module.exports=__webpack_require__(1092)},570:function(module,exports){},656:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__(379)},85:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return IonContext})),__webpack_require__.d(__webpack_exports__,"c",(function(){return Ion_useIon})),__webpack_require__.d(__webpack_exports__,"b",(function(){return IonUserMediaContext})),__webpack_require__.d(__webpack_exports__,"d",(function(){return IonUserMedia_useUserMedia}));var react=__webpack_require__(0),react_default=__webpack_require__.n(react),IonContext=react_default.a.createContext(null),Ion_useIon=function useIon(){return react_default.a.useContext(IonContext)},IonUserMediaContext=react_default.a.createContext({constraints:{audio:!0,video:!0},setConstraints:null,getUserMedia:null,localStream:null}),IonUserMedia_useUserMedia=function useUserMedia(){return react_default.a.useContext(IonUserMediaContext)}}},[[503,1,2]]]);
//# sourceMappingURL=main.1b9547d81eda3e1771fc.bundle.js.map